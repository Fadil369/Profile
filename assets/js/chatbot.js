document.addEventListener("DOMContentLoaded",()=>{const e="YOUR_GEMINI_API_KEY",n=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${e}`,t=document.getElementById("ai-chat-widget"),i=document.getElementById("chat-toggle"),a=document.getElementById("chat-close"),s=document.getElementById("chat-input"),o=document.getElementById("chat-send"),c=document.getElementById("chat-mic"),d=document.getElementById("chat-messages"),r=document.querySelectorAll(".quick-btn");let l,h=!1;if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const e=window.SpeechRecognition||window.webkitSpeechRecognition;l=new e,l.continuous=!1,l.lang="en-US",l.interimResults=!1,l.onstart=()=>{h=!0,c.classList.add("listening"),s.placeholder="Listening..."},l.onresult=e=>{const n=e.results[0][0].transcript;s.value=n,g(n)},l.onerror=()=>{u()},l.onend=()=>{u()}}else c.style.display="none";const u=()=>{h=!1,c.classList.remove("listening"),s.placeholder="Type or use mic..."},p=e=>{if(!("speechSynthesis"in window))return;window.speechSynthesis.cancel();const n=new SpeechSynthesisUtterance(e);n.lang="en-US";const t=window.speechSynthesis.getVoices().find(e=>e.name.includes("Male")||e.name.includes("Google US English"));t&&(n.voice=t),n.rate=1,n.pitch=1,window.speechSynthesis.speak(n)},m=async t=>{if("YOUR_GEMINI_API_KEY"===e){const e=t.toLowerCase();return e.includes("fadil")?"Dr. Mohamed El Fadil is a physician and Healthcare AI Architect based in Riyadh. He founded BrainSAIT to bridge clinical medicine and AI.":e.includes("brainsait")?"BrainSAIT is an AI ecosystem for healthcare. We do clinical decision support, NPHIES integration, and automated coding.":e.includes("nphies")||e.includes("fhir")?"Dr. Fadil is an expert in HL7 FHIR R4 and NPHIES standards, helping hospitals in Saudi Arabia achieve interoperability.":"I'm MacKey. Since I don't have my API key configured yet, I can only answer basic questions about Dr. Fadil's profile. Please add a Gemini API key to unlock my full brain!"}const i=`You are MacKey, a helpful and professional AI assistant named after Dr. Mohamed El Fadil's son. You are an expert on Dr. Fadil's profile.\n      Context:\n      - Dr. Fadil is a physician and AI Architect.\n      - CEO of BrainSAIT.\n      - Expert in NPHIES, FHIR, Clinical NLP, and Python.\n      - Based in Riyadh, Saudi Arabia.\n      - Mission: "Original Intelligence (OI) + AI".\n      \n      User Query: ${t}\n      \n      Respond concisely (under 50 words) and professionally.`;try{const e=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:i}]}]})});if(!e.ok)throw new Error("Gemini API Error");const t=await e.json();return t.candidates[0].content.parts[0].text}catch(e){return"I'm having trouble connecting to my brain right now. Please try again later."}},y=(e,n)=>{const t=document.createElement("div");t.className="ai"===n?"ai-msg":"user-msg",t.textContent=e,d.appendChild(t),d.scrollTop=d.scrollHeight},g=async e=>{if(!e.trim())return;y(e,"user");const n=await m(e);y(n,"ai"),p(n)};i.addEventListener("click",()=>t.classList.add("active")),a.addEventListener("click",()=>{t.classList.remove("active"),window.speechSynthesis.cancel()}),o.addEventListener("click",()=>{g(s.value),s.value=""}),s.addEventListener("keypress",e=>{"Enter"===e.key&&(g(s.value),s.value="")}),c.addEventListener("click",()=>{h?l.stop():l.start()}),r.forEach(e=>{e.addEventListener("click",()=>{g(e.getAttribute("data-query"))})})});